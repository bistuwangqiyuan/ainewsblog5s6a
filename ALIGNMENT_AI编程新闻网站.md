### ALIGNMENT — AI 编程新闻网站（依据 5S 与 6A 规范）

| 模块           | 内容                                                                                                                                                                                                                        |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 项目现状       | 当前仓库为 Astro + Netlify 平台模板，已含 `src/`, `public/`, `netlify/edge-functions/` 等目录；将保持现有结构，不新增顶层目录，在既有目录下新增页面与函数文件。                                                             |
| 目标与受众     | 中文 PC 网页端；聚焦“AI 相关的编程”资讯与社区：新闻聚合、文章资讯、用户论坛、AI 专家问答、用户系统（登录/注册）、会员等级、积分体系、用户反馈、站内消息、统计视图。免费站点，无广告/变现模块。                              |
| 技术栈约束     | 前端：Astro 页面 + 原生 HTML/CSS/JS（不使用 TypeScript）；数据：Supabase（Auth、DB、Storage、RLS）；自动化与抓取：Netlify Functions（含定时任务），必要时调用 AI API（DeepSeek 优先，后续可扩展）。不引入本地后端服务。     |
| 安全与合规     | 所有密钥放入环境变量（Netlify 环境变量/Supabase 变量）；前端仅使用 `PUBLIC_` 前缀变量；严禁写死密钥。实现敏感词简单规则过滤；文件类型与大小限制（≤10MB）。不使用模拟/降级数据。                                             |
| 关键页面       | 首页新闻流、论坛/问答（同一数据结构双标签）、投稿、消息、反馈、登录注册、个人资料（积分/等级/统计）、关于我们/隐私/服务协议/网站介绍等。均复用统一 Header/Footer。                                                          |
| 数据采集       | 每日自动抓取 ≥20 个站点（RSS/API），每站抓取 10–100 条，去重后 ≥100 条入库；以时间新鲜度为主排序（如可用，参考第三方热度指标）。使用 Netlify 定时函数写入 Supabase。                                                        |
| 互动能力       | 点赞、收藏、评论、举报（仅一级评论；用户不可编辑/删除评论或收藏）。                                                                                                                                                         |
| 搜索与筛选     | 按来源、时间、关键词筛选；分页加载。                                                                                                                                                                                        |
| 文件上传       | 反馈、发帖/回答支持图片/视频上传，限制常见格式与大小 ≤10MB；采用 Supabase Storage Bucket（public 与 private 区分）。                                                                                                        |
| 统计/积分/等级 | 记录浏览量、行为积分流水，计算等级；积分事件：注册、登录、发帖、评论、被点赞等；等级阈值分级。个人资料页展示统计与流水。                                                                                                    |
| 边界（不做）   | 无后台管理、无第三方登录、无广告投放、无订阅付费、无多角色权限（除基础登录），无内容审核（仅本地敏感词校验），评论不支持子级/楼中楼，不支持编辑/删除评论和收藏。                                                            |
| 与现有代码对齐 | 复用 `src/components/Header.astro`, `Footer.astro`, `src/layouts/Layout.astro`；在 `src/pages/` 增加页面；在 `netlify/` 目录下放置函数文件（如 `crawler.js`, `aiProxy.js`）；通过 `netlify.toml` 指定函数目录为 `netlify`。 |

#### 关键决策与确认（智能决策策略）

| 议题              | 结论                                                                                                                                                                                      | 备注                                   |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------- |
| 定时抓取实现位置  | 使用 Netlify Scheduled Functions；文件放置 `netlify/` 根下（不新建新目录），通过 `netlify.toml` 将函数目录设置为 `netlify`                                                                | 满足“不新建文件夹”且可定时执行         |
| 抓取源            | 优先 RSS/API 可公开访问的新闻/技术/学术站点（含 arXiv、InfoQ、TechCrunch、VentureBeat、Google AI Blog、OpenAI Blog、DeepMind、MS Research、NVIDIA、StackOverflow、dev.to、HN Algolia 等） | 详见 DESIGN 文档“抓取源列表”           |
| AI 问答           | 先支持 DeepSeek（OpenAI 兼容接口），其余厂商后续可在同一代理函数中扩展；失败时返回错误并提示，不降级/不伪造                                                                               | 符合“绝不使用 fallback 模拟数据”的规则 |
| 前端 Supabase SDK | 浏览器端通过 ESM CDN 按需导入 `@supabase/supabase-js@2`，使用 `PUBLIC_` 环境变量初始化                                                                                                    | 避免本地依赖安装                       |
| 数据去重策略      | 以 `url` 唯一约束为主（`news_items.url` unique），REST upsert `on_conflict=url`                                                                                                           | 跨源去重可靠且简单                     |
| 权限/RLS          | 读取开放；写操作基于登录用户（如评论/点赞/收藏/投稿）；禁止更新/删除评论和收藏                                                                                                            | 详见 DESIGN 文档策略与 SQL             |

#### 疑问澄清（已内抉）

| 疑问                                   | 决策                                                                                       |
| -------------------------------------- | ------------------------------------------------------------------------------------------ |
| “不要新建文件夹”与函数目录冲突？       | 使用现有 `netlify/` 目录，函数文件直接置于其中；不新增新目录。                             |
| 测试目录 `/tests` 要求 vs 不新建文件夹 | 暂将测试文件置于仓库根（如 `tests.html`, `tests.spec.js`），待允许后可迁移到 `/tests`。    |
| Google Scholar 数据源                  | Scholar 无开放 API，易受限；不纳入首批抓取源，改以 arXiv/期刊/科技媒体/社区 API+RSS 替代。 |
